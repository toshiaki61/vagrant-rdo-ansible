---
- yum: name={{ item }} state=installed
  with_items:
    - openstack-heat-api
    - openstack-heat-engine
    - openstack-heat-api-cfn
  tags: heat

- shell: openstack-config --set /etc/heat/heat.conf database connection mysql://heat:{{ HEAT_DBPASS }}@controller/heat && touch ~/.executed-heat-01 creates=~/.executed-heat-01
  tags: heat

- shell: heat-manage db_sync && touch ~/.executed-heat-02 creates=~/.executed-heat-02
  tags: heat

- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken auth_host controller && touch ~/.executed-heat-041 creates=~/.executed-heat-041
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken auth_port 35357 && touch ~/.executed-heat-042 creates=~/.executed-heat-042
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken auth_protocol http && touch ~/.executed-heat-043 creates=~/.executed-heat-043
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken auth_uri http://controller:5000/v2.0 && touch ~/.executed-heat-044 creates=~/.executed-heat-044
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken admin_tenant_name service && touch ~/.executed-heat-045 creates=~/.executed-heat-045
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken admin_user heat && touch ~/.executed-heat-046 creates=~/.executed-heat-046
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf keystone_authtoken admin_password {{ HEAT_PASS }} && touch ~/.executed-heat-047 creates=~/.executed-heat-047
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf ec2authtoken auth_uri http://controller:5000/v2.0 && touch ~/.executed-heat-048 creates=~/.executed-heat-048
  tags: heat

- shell: openstack-config --set /etc/heat/heat.conf DEFAULT heat_metadata_server_url http://10.0.0.11:8000 && touch ~/.executed-heat-10 creates=~/.executed-heat-10
  tags: heat
- shell: openstack-config --set /etc/heat/heat.conf DEFAULT heat_waitcondition_server_url http://10.0.0.11:8000/v1/waitcondition && touch ~/.executed-heat-11 creates=~/.executed-heat-11
  tags: heat

- service: name={{ item }} state=running enabled=yes
  with_items: 
    - openstack-heat-api
    - openstack-heat-api-cfn
    - openstack-heat-engine
  tags: heat
